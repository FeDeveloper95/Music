<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Music</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#F8F9FC">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1A1C1E">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" href="icons/icon-192x192.png" type="image/png">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header" id="sidebar-header">
                <h2 class="sidebar-title">Tutti i brani</h2>
                <button class="icon-button close-sidebar-btn"><span class="material-symbols-outlined">close</span></button>
            </div>
            <div class="sidebar-content">
                <div class="search-container">
                    <span class="material-symbols-outlined">search</span>
                    <input type="text" id="search" placeholder="Cerca brani o artisti">
                </div>
                <ul class="song-list" id="song-list"></ul>
            </div>
            <div class="sidebar-footer">
                <div class="settings-menu-container">
                     <li class="settings-list-item" id="settings-btn">
                        <span class="material-symbols-outlined">settings</span>
                        <span>Impostazioni ed altro</span>
                    </li>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="main-content-inner">
                <div id="home-view" class="view active">
                    <div class="page-header">
                        <h2 class="sidebar-title"></h2>
                    </div>
                    <div class="home-icon-container">
                        <span class="material-symbols-outlined">music_note</span>
                    </div>
                    <h1>Ciao, <span id="username" contenteditable="true">utente</span>!</h1>
                    <p id="welcome-message">Seleziona un brano per iniziare.</p>
                </div>

                <div id="player-view" class="view">
                    <div class="player-content">
                        <div class="song-image" id="song-image-touch-area">
                            <img src="covers/default-cover.jpg" alt="Immagine Canzone">
                        </div>
                        <div class="song-details">
                            <h2>Titolo Canzone</h2>
                            <p>Artista</p>
                        </div>
                        <div class="progress-container">
                            <input type="range" id="progress-bar" value="0">
                            <div class="time-labels">
                                <span id="current-time">0:00</span>
                                <span id="total-time">0:00</span>
                            </div>
                        </div>
                        <div class="controls">
                            <button class="icon-button" id="shuffle"><span class="material-symbols-outlined">shuffle</span></button>
                            <button class="icon-button" id="prev"><span class="material-symbols-outlined">skip_previous</span></button>
                            <button class="fab" id="play-pause"><span class="material-symbols-outlined">play_arrow</span></button>
                            <button class="icon-button" id="next"><span class="material-symbols-outlined">skip_next</span></button>
                            <button class="icon-button" id="repeat"><span class="material-symbols-outlined">repeat</span></button>
                        </div>
                        <div class="player-buttons-bottom">
                             <a id="download-btn" class="player-button-bottom" download>
                                <span class="material-symbols-outlined">download</span>
                            </a>
                             <button class="player-button-bottom" id="share-btn"><span class="material-symbols-outlined">share</span></button>
                        </div>
                    </div>
                </div>
                 <div id="activity-page" class="page-view hidden">
                    <div class="page-header">
                        <button class="icon-button" id="back-to-settings-btn">
                            <span class="material-symbols-outlined">arrow_back</span>
                        </button>
                        <h2 class="page-title">La tua attività</h2>
                        <button class="icon-button" id="activity-menu-btn">
                            <span class="material-symbols-outlined">more_vert</span>
                        </button>
                    </div>
                    <div class="page-content">
                        <h3 class="activity-section-title">Top played</h3>
                        <div id="top-played-container" class="expressive-container">
                            </div>
                
                        <h3 class="activity-section-title">Altre</h3>
                        <ul class="activity-list expressive-container" id="others-played-list">
                            </ul>
                    </div>
                    <ul class="settings-menu" id="activity-menu">
                        <li class="menu-item" id="reset-activity-btn">
                            <span class="material-symbols-outlined">delete</span>
                            <span>Resetta attività</span>
                        </li>
                    </ul>
                </div>
            </div>
        </main>
        
        <div id="info-view" class="fullscreen-view hidden">
            <div class="popup-content">
                <div class="page-header">
                    <h2>Informazioni</h2>
                    <button class="icon-button" id="close-info-btn">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="page-content">
                    <div class="info-section">
                        <h3>Brani e Copyright</h3>
                        <p>Tutte le canzoni presenti in questa applicazione sono di proprietà dell'artista "Bush". I brani sono remix realizzati per puro scopo hobbistico e non a scopo di lucro.</p>
                    </div>
                    <div class="info-section">
                        <h3>Sviluppo</h3>
                        <p>Questo sito è stato interamente scritto e sviluppato da Bush con l'aiuto di Google Gemini per alcuni bugfix.</p>
                    </div>
                    <div class="info-section">
                        <h3>L'Autore</h3>
                        <p>Bush, il cui vero nome è Federico Gobbi, è un ragazzo nato il 3 giugno 2009. Attualmente frequenta il liceo scientifico e coltiva la passione per la musica e la programmazione.</p>
                    </div>
                </div>
                <div class="popup-footer">
                    <a href="https://github.com/FeDeveloper95" target="_blank" rel="noopener noreferrer">
                        <img src="github.png" alt="GitHub" class="social-icon">
                    </a>
                    <img src="gemini.png" alt="Google Gemini" class="social-icon">
                </div>
            </div>
        </div>

        <div id="changelog-view" class="fullscreen-view hidden">
            <div class="popup-content">
                <div class="page-header">
                    <h2>Changelog v3.4</h2>
                    <button class="icon-button" id="close-changelog-btn">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="page-content">
                    <div class="info-section">
                        <h3>Nuove Funzionalità</h3>
                        <ul>
                            <li><b>Pagina Attività:</b> Introdotta una nuova pagina "La tua attività" per visualizzare le canzoni più ascoltate.</li>
                            <li><b>Reset Attività:</b> Aggiunta l'opzione per resettare le statistiche di ascolto.</li>
                        </ul>
                        <h3>Miglioramenti UI/UX</h3>
                        <ul>
                            <li><b>Design Espressivo:</b> Applicato un nuovo stile coerente alla pagina attività e alla lista brani nella sidebar.</li>
                            <li><b>Sidebar Dinamica:</b> L'intestazione della sidebar ora si riduce elegantemente durante lo scorrimento.</li>
                            <li><b>UX Mobile Migliorata:</b> La navbar inferiore scompare quando si visualizzano pagine a schermo intero e la tab attiva si aggiorna automaticamente alla chiusura della sidebar.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="theme-view" class="fullscreen-view hidden">
            <div class="popup-content">
                <div class="page-header">
                    <h2>Tema</h2>
                    <button class="icon-button" id="close-theme-btn">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="page-content">
                    <div class="theme-option">
                        <input type="radio" id="theme-system" name="theme" value="system" checked>
                        <label for="theme-system">Predefinito del dispositivo</label>
                    </div>
                    <div class="theme-option">
                        <input type="radio" id="theme-light" name="theme" value="light">
                        <label for="theme-light">Chiaro</label>
                    </div>
                    <div class="theme-option">
                        <input type="radio" id="theme-dark" name="theme" value="dark">
                        <label for="theme-dark">Scuro</label>
                    </div>
                </div>
            </div>
        </div>

        <nav class="mobile-nav" id="mobile-nav">
             <button class="nav-item" data-action="open-songs"><span class="material-symbols-outlined">library_music</span><span class="nav-label">Brani</span></button>
            <button class="nav-item active" data-action="go-home"><span class="material-symbols-outlined">home</span><span class="nav-label">Home</span></button>
            <button class="nav-item" data-action="go-player"><span class="material-symbols-outlined">play_circle</span><span class="nav-label">Now playing</span></button>
        </nav>

        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        <div id="easter-egg-container"></div>
        <div id="toast-notification" class="toast"></div>
        <div id="offline-indicator" class="toast hidden">Sei offline. La musica precedentemente caricata è disponibile.</div>
        
        <ul class="settings-menu" id="settings-menu">
            <li class="menu-item" id="activity-btn">
                <span class="material-symbols-outlined">analytics</span>
                <span>La tua attività</span>
            </li>
            <li class="menu-item" id="theme-btn">
                <span class="material-symbols-outlined">palette</span>
                <span>Tema</span>
            </li>
            <li class="menu-item" id="download-all-btn">
                <span class="material-symbols-outlined">download</span>
                <span>Download di tutte le canzoni</span>
            </li>
            <li class="menu-item" id="copy-link-btn">
                <span class="material-symbols-outlined">link</span>
                <span>Copia link</span>
            </li>
            <li class="menu-item" id="changelog-btn">
                <span class="material-symbols-outlined">description</span>
                <span>Changelog</span>
            </li>
            <li class="menu-item" id="info-btn">
                <span class="material-symbols-outlined">info</span>
                <span>Informazioni</span>
            </li>
        </ul>
    </div>

    <audio id="audio-player" src=""></audio>
    <script src="script.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(reg => console.log('Service Worker registrato.', reg))
                .catch(err => console.log('Registrazione Service Worker fallita:', err));
        }
    </script>
</body>
</html>