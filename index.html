<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Music</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#F8F9FC">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1A1C1E">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" href="icons/icon-192x192.png" type="image/png">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">
                    <h2 class="sidebar-title">Tutti i brani</h2>
                    <button class="icon-button close-sidebar-btn"><span class="material-symbols-outlined">close</span></button>
                </div>
                <div class="search-container">
                    <span class="material-symbols-outlined">search</span>
                    <input type="text" id="search" placeholder="Cerca brani o artisti">
                </div>
                <ul class="song-list" id="song-list"></ul>
            </div>
            <div class="sidebar-footer">
                <ul class="song-list" id="settings-list">
                     <li class="settings-list-item" id="info-btn">
                        <span class="material-symbols-outlined">info</span>
                        <span>Informazioni</span>
                    </li>
                </ul>
            </div>
        </aside>

        <main class="main-content">
            <div id="home-view" class="view">
                <div class="page-header">
                    <h2 class="sidebar-title"></h2>
                    <button class="icon-button" id="changelog-btn">
                        <span class="material-symbols-outlined">description</span>
                    </button>
                </div>
                <div class="home-icon-container">
                    <span class="material-symbols-outlined">music_note</span>
                </div>
                <h1>Ciao, <span id="username" contenteditable="true">utente</span>!</h1>
                <p>Scrivi il tuo nome e premi Invio.<br>Seleziona un brano per iniziare.</p>
            </div>

            <div id="player-view" class="view hidden">
                <div class="player-content">
                    <div class="song-image">
                        <img src="covers/default-cover.jpg" alt="Immagine Canzone">
                    </div>
                    <div class="song-details">
                        <h2>Titolo Canzone</h2>
                        <p>Artista</p>
                    </div>
                    <div class="progress-container">
                        <input type="range" id="progress-bar" value="0">
                        <div class="time-labels">
                            <span id="current-time">0:00</span>
                            <span id="total-time">0:00</span>
                        </div>
                    </div>
                    <div class="controls">
                        <button class="icon-button" id="shuffle"><span class="material-symbols-outlined">shuffle</span></button>
                        <button class="icon-button" id="prev"><span class="material-symbols-outlined">skip_previous</span></button>
                        <button class="fab" id="play-pause"><span class="material-symbols-outlined">play_arrow</span></button>
                        <button class="icon-button" id="next"><span class="material-symbols-outlined">skip_next</span></button>
                        <button class="icon-button" id="repeat"><span class="material-symbols-outlined">repeat</span></button>
                    </div>
                    <a id="download-btn" class="icon-button hidden" download>
                        <span class="material-symbols-outlined">download</span>
                    </a>
                </div>
            </div>
        </main>
        
        <div id="info-view" class="fullscreen-view hidden">
            <div class="popup-content">
                <div class="page-header">
                    <h2>Informazioni</h2>
                    <button class="icon-button" id="close-info-btn">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="page-content">
                    <div class="info-section">
                        <h3>Brani e Copyright</h3>
                        <p>Tutte le canzoni presenti in questa applicazione sono di proprietà dell'artista "Bush". I brani sono remix realizzati per puro scopo hobbistico e non a scopo di lucro.</p>
                    </div>
                    <div class="info-section">
                        <h3>Sviluppo</h3>
                        <p>Questo sito è stato interamente scritto e sviluppato da Bush con l'aiuto di Google Gemini per alcuni bugfix.</p>
                    </div>
                    <div class="info-section">
                        <h3>L'Autore</h3>
                        <p>Bush, il cui vero nome è Federico Gobbi, è un ragazzo nato il 3 giugno 2009. Attualmente frequenta il liceo scientifico e coltiva la passione per la musica e la programmazione.</p>
                    </div>
                </div>
                <div class="popup-footer">
                    <a href="https://github.com/FeDeveloper95" target="_blank" rel="noopener noreferrer">
                        <img src="github.png" alt="GitHub" class="social-icon">
                    </a>
                    <img src="gemini.png" alt="Google Gemini" class="social-icon">
                </div>
            </div>
        </div>

        <div id="changelog-view" class="fullscreen-view hidden">
            <div class="popup-content">
                <div class="page-header">
                    <h2>Changelog v3.1</h2>
                    <button class="icon-button" id="close-changelog-btn">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="page-content">
                    <div class="info-section">
                        <h3>Novità</h3>
                        <ul>
                            <li>Download dei brani: È stata reintrodotta la funzionalità di download.</li>
                            <li>URL semplificati: I link dei brani ora usano il nome del brano invece dell'indice numerico.</li>
                            <li>Modalità offline avanzata: L'applicazione è ora completamente fruibile offline, inclusi tutti i brani e le copertine.</li>
                            <li>Changelog: È stato aggiunto questo popup per informare sulle nuove funzionalità.</li>
                            <li>Tasto play: L'animazione del tasto Play/Pausa è stata aggiornata per seguire le regole del design Material 3 Expressive.</li>
                        </ul>
                    </div>
                    <div class="info-section">
                        <h3>Bugfix</h3>
                        <ul>
                            <li>Risolto un bug che impediva il corretto funzionamento del pulsante "Successivo" in modalità ripeti.</li>
                            <li>Migliorata la gestione degli stati di riproduzione.</li>
                            <li>Migliorata la visualizzazione degli elementi su dispositivi desktop e tablet.</li>
                            <li>Rimossa la scritta Home sia su desktop che su mobile.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <nav class="mobile-nav" id="mobile-nav">
             <button class="nav-item" data-action="open-songs"><span class="material-symbols-outlined">library_music</span><span class="nav-label">Brani</span></button>
            <button class="nav-item active" data-action="go-home"><span class="material-symbols-outlined">home</span><span class="nav-label">Home</span></button>
            <button class="nav-item" data-action="go-player"><span class="material-symbols-outlined">play_circle</span><span class="nav-label">In riproduzione</span></button>
        </nav>

        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        <div id="easter-egg-container"></div>
    </div>

    <audio id="audio-player" src=""></audio>
    <script src="script.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(reg => console.log('Service Worker registrato.', reg))
                .catch(err => console.log('Registrazione Service Worker fallita:', err));
        }
    </script>
</body>
</html>